<!--pages/stats/stats.wxml-->
<view class="stats-container">
  <!-- æ€»è§ˆå¡ç‰‡ -->
  <view class="overview-section">
    <view class="section-title">ğŸ“Š æ€»è§ˆ</view>
    
    <!-- æ€»åˆ©æ¶¦å¡ç‰‡ï¼ˆå•ç‹¬ä¸€è¡Œï¼‰ -->
    <view class="profit-row">
      <view class="overview-card profit-card">
        <view class="card-title">æ€»åˆ©æ¶¦ (å®Œæˆäº¤æ˜“)</view>
        <view class="card-value {{statsData.totalProfitRmb >= 0 ? 'positive' : 'negative'}}">
          Â¥{{statsData.totalProfitRmb || '0.00'}}
        </view>

      </view>
    </view>
    
    <!-- æŠ•å…¥å’Œæ”¶å…¥å¡ç‰‡ï¼ˆå·¦å³æ’åˆ—ï¼‰ -->
    <view class="stats-row">
      <view class="overview-card stats-card">
        <view class="card-title">æ€»æŠ•å…¥</view>
        <view class="card-value">Â¥{{statsData.totalInvestment || '0.00'}}</view>

      </view>
      
      <view class="overview-card stats-card">
        <view class="card-title">æ€»æ”¶å…¥</view>
        <view class="card-value positive">Â¥{{statsData.totalIncome || '0.00'}}</view>

      </view>
    </view>
    
    <!-- åº“å­˜æˆæœ¬å¡ç‰‡ï¼ˆå•ç‹¬ä¸€è¡Œï¼‰ -->
    <view class="inventory-row">
      <view class="overview-card inventory-card">
        <view class="card-title">ğŸ“¦ åº“å­˜æˆæœ¬</view>
        <view class="card-value">Â¥{{statsData.inventoryCost || '0.00'}}</view>
        <view class="card-subtitle">
          <text class="inventory-count" wx:if="{{statsData.inventoryItemCount > 0}}">
            ({{statsData.inventoryItemCount}}ä»¶åœ¨åº“)
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ©æ¶¦ç‡å’Œå®Œæˆäº¤æ˜“ç»Ÿè®¡ -->
  <view class="profit-rate-section">
    <view class="profit-rate-card">
      <view class="card-title">ğŸ’° åˆ©æ¶¦ç‡ (å®Œæˆäº¤æ˜“)</view>
      <view class="profit-rate-value {{statsData.profitRate >= 0 ? 'positive' : 'negative'}}">
        {{statsData.profitRate || '0.00'}}%
      </view>
      <view class="profit-rate-desc">
        <text wx:if="{{statsData.completedTransactionPairs > 0}}">
          å·²å®Œæˆ{{statsData.completedTransactionPairs}}å•äº¤æ˜“
        </text>
        <text wx:else>æš‚æ— å®Œæˆäº¤æ˜“</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç»Ÿè®¡ -->
  <view class="category-section">
    <view class="section-title">ğŸ·ï¸ åˆ†ç±»ç»Ÿè®¡</view>
    <view class="category-content" wx:if="{{statsData.categoryStats && statsData.categoryStats.length > 0}}">
      <!-- CSSçº¯æ ·å¼é¥¼å›¾ -->
      <view class="css-pie-container">
        <view class="css-pie-chart" style="background: {{pieChartGradient}};">
          <!-- ä¸­å¿ƒåœ† -->
          <view class="pie-center">
            <view class="pie-center-text">
              <text class="pie-total-label">æ€»åˆ©æ¶¦</text>
              <text class="pie-total-value {{statsData.totalProfitRmb >= 0 ? 'positive' : 'negative'}}">
                Â¥{{statsData.totalProfitRmb}}
              </text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å›¾ä¾‹ -->
      <view class="pie-legend">
        <view class="legend-item" 
              wx:for="{{statsData.categoryStats}}" 
              wx:key="item_type"
              style="--animation-delay: {{index}};">
          <view class="legend-color" style="background-color: {{item.color}}"></view>
          <view class="legend-info">
            <view class="legend-label">
              <text class="legend-icon">{{item.icon}}</text>
              <text class="legend-name">{{item.name}}</text>
            </view>
            <view class="legend-value">
              <text class="legend-profit {{item.profit >= 0 ? 'positive' : 'negative'}}">Â¥{{item.profit}}</text>
              <text class="legend-percentage">({{item.percentage}}%)</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:else>
      <text>æš‚æ— åˆ†ç±»æ•°æ®</text>
    </view>
  </view>

  <!-- æœˆåº¦è¶‹åŠ¿ -->
  <view class="trend-section">
    <view class="trend-header">
      <view class="section-title">ğŸ“ˆ æœˆåº¦è¶‹åŠ¿</view>
      <view class="time-filter">
        <view class="filter-btn {{trendTimeRange === '6' ? 'active' : ''}}" 
              bindtap="onTrendTimeRangeChange" data-range="6">
          æœ€è¿‘6ä¸ªæœˆ
        </view>
      </view>
    </view>
    
    <view class="chart-container">
      <view class="chart-placeholder" wx:if="{{!statsData.monthlyTrend || statsData.monthlyTrend.length === 0}}">
        <text>æš‚æ— è¶‹åŠ¿æ•°æ®</text>
      </view>
      <view class="chart-content" wx:else>
        <!-- æ•°å€¼åˆ»åº¦çº¿ -->
        <view class="chart-y-axis">
          <view class="y-axis-line" wx:for="{{chartConfig.yAxisLabels}}" wx:key="*this">
            <text class="y-axis-label">{{item}}</text>
          </view>
        </view>
        
        <!-- æŸ±çŠ¶å›¾åŒºåŸŸ -->
        <view class="chart-bars" data-range="{{trendTimeRange}}">
          <view class="chart-bar-item" wx:for="{{statsData.monthlyTrend}}" wx:key="month">
            <!-- æ•°å€¼æ ‡ç­¾ï¼ˆåœ¨æŸ±å­ä¸Šæ–¹ï¼‰ -->
            <view class="bar-value-top" wx:if="{{item.profit !== 0 && item.profit > 0}}">Â¥{{item.profit}}</view>
            
            <!-- æŸ±å­ -->
            <view class="chart-bar-container">
              <view class="chart-bar {{item.profit >= 0 ? 'positive' : 'negative'}}" 
                    style="height: {{item.barHeight}}%; min-height: {{item.profit === 0 ? '4rpx' : '8rpx'}};">
              </view>
            </view>
            
            <!-- è´Ÿå€¼æ•°æ®æ ‡ç­¾ï¼ˆåœ¨æŸ±å­ä¸‹æ–¹ï¼‰ -->
            <view class="bar-value-bottom" wx:if="{{item.profit !== 0 && item.profit < 0}}">Â¥{{item.profit}}</view>
            
            <!-- æœˆä»½æ ‡ç­¾ -->
            <view class="chart-bar-label">{{item.monthName}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>


</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{isLoading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­...</text>
  </view>
</view>
